<?php
// lib/form/scoutEnrollForm.class.php
    class ScoutEnrollForm extends sfForm {
        public function configure() {
          $this->widgetSchema['scout_id'] = new sfWidgetFormDoctrineChoice(
              array(
                'model' => 'ScssScout',
                'query' => Doctrine::getTable('ScssScout')->createQuery('a')->filterByTroop(sfContext::getInstance()->getUser()->getProfile()->getActiveEnrollment()->getTroop())
              ))->setDefault($this->getOption('scout_slug');
          }
          $scout = new ScssScout();
            $sForm = new sfForm();
            $pMax = sfContext::getInstance()->getUser()->getProfile()->getActiveEnrollment()->getWeek()->getPeriods();
            foreach($pMax as $i => $period) {
                $enroll = new ScssScoutEnrollment();
                $enroll->Scout = $scout;

                $form = new ScssScoutEnrollmentForm($enroll,array('period'=>$period));
                $sForm->embedForm($i,$form);
            }
            $this->embedForm('ClassesByPeriod',$sForm);
        }
    }
