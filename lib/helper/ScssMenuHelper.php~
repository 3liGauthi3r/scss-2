<?php
  /**
   * Renders a custom menu
   * @param string $menu
   */
function render_menu($menu = null) {
  if(is_null($menu))  $menu = load_menu('menu.php');
  $nav = '<ul class="navbar menu">';
  foreach($menu as $child) {
    if(sfContext::getInstance()->getUser()->hasCredential($child->getCredentials())) {
      $nav .= '<li class="menu-item '.($child->hasChildren()?'has-sub-menu':'').'" id="'.Scss::slugify($child->getName()).'-menu-item">'.$child->renderLink();//link_to($child->getName(),$child->getRoute(),$child->getLinkOptions());
      if($child->hasChildren()) {
        $nav .= '<ul class="sub-menu">';
        foreach($child as $baby) {
          if($baby->checkUserAccess()) {
            $nav .= '<li class="menu-item" id="'.Scss::slugify($baby->getName()).'">'.link_to($baby->getName(),$baby->getRoute(),$baby->getLinkOptions()).'</li>';
          }
        }
        $nav .= '</ul>';
      }
      $nav .= '</li>';
    }
  }
  $nav .= '</ul>';
  print_r($nav);
}
  /**
   * Loads a menu from a config file
   */
function load_menu() {
  sfConfig::set('sf_web_debug', true);
  $arr = sfYaml::load(sfConfig::get('sf_app_config_dir').'/'.sfConfig::get('app_menu_file'));
  $menu = ddNavMenuItem::createFromArray($arr);
/*  foreach ( $menu as $elem ) {*/ var_dump($menu[0]->toArray()); //}
  return $menu;
}
/*function load_menu($file = 'menu.php') {
if(($ext = substr(strrchr($file, '.'), 1))=='yml') {
    $arr = sfYaml::load(sfConfig::get('sf_app_config_dir').'/'.$file);
    $menu = ioMenuItem::createFromArray($arr);
    sfContext::getInstance()->getLogger()->info('file: '.sfConfig::get('sf_app_config_dir').'/'.$file);
    sfContext::getInstance()->getLogger()->info('menu is obj: '.is_object($menu));
    sfContext::getInstance()->getLogger()->info('menu size: '.$menu->count());
    foreach($menu as $xx=>$x) {
      if(is_array($x)) {
        foreach($x as $yy => $y) {
          if(is_array($y)) {
            foreach($y as $zz => $z) {
              if(is_array($z)) {
                foreach($z as $aa => $a)  sfContext::getInstance()->getLogger()->info("----$aa: $a");
              }
              else {
                sfContext::getInstance()->getLogger()->info("---$zz: $z");
              }
            }
          }
          else {
            sfContext::getInstance()->getLogger()->info("--$yy: $y");
          }
        }
      }
      else {
        sfContext::getInstance()->getLogger()->info("$xx: $x");
      }
    }
  } else {
    include_once(sfConfig::get('sf_app_config_dir').'/'.$file);
 }
  return $menu;
}
 */
